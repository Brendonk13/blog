[{"content":"Background Info VPN\u0026rsquo;s in my words The purpose of a VPN server at its heart is to give remote clients a private ip address on some private IP subnet that they cannot access.\nBasically the VPN server can access some subnetworks that you can\u0026rsquo;t access but want to access.\nTo do this the VPN gives you an IP address on your desired subnet which effectively makes you a client on that network with access to most or all (depending on firewall/ACL rules of the default gateway for the subnet) machines on that network.\nThis is accomplished by your local machine sending all traffic destined for the previously inaccessible subnet through the VPN server, which in turn forwards your requests to the appropriate client on the desired subnet!\nWhy wireguard? Number 1 reason is hands down for street cred, people will fear and respect you for using wireguard as long as you constantly announce that you use it (emphasis on constantly). Besides possibly leading to your crush finally acknowledging your existence, wireguard is just amazing: fast to setup, to manage and to ping.\nSetup steps Create keys Run the following commands for every peer\nwg genkey | tee privatekey | wg pubkey \u0026gt; publickey Then set perms so that only the user that created them can read/write them\nsudo chmod 600 *key Allow ip forwarding on VPN server sudo sysctl -w net.ipv4.ip_forward=1 (untested) Note: To make the change permanent, add net.ipv4.ip_forward = 1 to /etc/sysctl.d/99-sysctl.conf.\nCreate config files 1) Create the following files on each machine\nsudoedit /etc/wireguard/wg0.conf  VPN Client's wg0.conf  [Interface] # The IP address that this client will have on the WireGuard network. # Note the /32 means this client can only have one address within the tunnel # Whereas the server has a /24 since it can use any Address = 10.101.0.2/32 # The private key you generated for the client previously. PrivateKey = :) [Peer] # VPN Server\u0026#39;s public key. PublicKey = public ! # The WireGuard server to connect to. # Note: this address must be reachable on the client\u0026#39;s network Endpoint = 192.168.0.20:51821 # The subnets this WireGuard VPN is in control of. # Implication ==\u0026gt; this client\u0026#39;s (client who has this file) ping\u0026#39;s to these subnets will go through this peer\u0026#39;s endpoint instead of another gateway # Implication ==\u0026gt; This client (meaning ^) can access these subnet\u0026#39;s if this wireguard vpn server can access them ! AllowedIPs = 10.101.0.0/24, 10.0.50.0/24 # Ensures that your home router does not kill the tunnel, by sending a ping # every 25 seconds. PersistentKeepalive = 25 \n  VPN Server's wg0.conf   [Interface] # Configuration for the server # Set the IP subnet that will be used for the WireGuard network. Address = 10.101.0.1/24 # The port that will be used to listen to connections. 51820 is the default. ListenPort = 51821 # The output of `wg genkey` for the server. PrivateKey = :) # FROM: https://wiki.archlinux.org/index.php/WireGuard#Server # Apperently (from ^^) if the server is behind a router and receives traffic via NAT, these iptables rules are not needed PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -A FORWARD -o %i -j ACCEPT; iptables -t nat -A POSTROUTING -o CHANGE_ME:eth0.50 -j MASQUERADE PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -D FORWARD -o %i -j ACCEPT; iptable s -t nat -D POSTROUTING -o CHANGE_ME:eth0.50 -j MASQUERADE [Peer] # Connecting client\u0026#39;s public key PublicKey = public ! # The IP address that this peer has WITHIN the tunnel AllowedIPs = 10.101.0.2/32 # Ensures that your home router does not kill the tunnel, by sending a ping every 25 seconds. PersistentKeepalive = 25 \n 2) wg-quick up wg0 on both machines and you\u0026rsquo;re done\nQ/A Q: I\u0026rsquo;m confused, I keep hearing the terms clients and servers and peers interchanged but WHO IS WHO ARENT THEY ALL PEERS??  A: Yes they are all peers but we can mimic a client-server model using wireguard which is what is shown here :)  Q: What would I use this dang thing for anyways  A: For example, people who want remote access to some computer in their house might have:   A machine with the servers config file on their private (no open ports) home network (tweaked so this server also has the clients endpoint in its config file) A publicly acessible Amazon EC2 instance with the client configuration.   As long as PersistentKeepalive is set and a connection is established by the \u0026ldquo;server\u0026rdquo; to the EC2 \u0026ldquo;client\u0026rdquo; (established by ping or any communication then PersistentKeepalive makes the connection stay active) then we can connect to the publicly innaccessable \u0026ldquo;server\u0026rdquo; by connecting to the public EC2 \u0026ldquo;client\u0026rdquo; :)  Q: Where can I find further resources for wireguard or VPN\u0026rsquo;s in general  A: The arch wiki is always a great resource, the talk that Jason Donenfeld gave to introduce wireguard provides an interesting not-overly-technical analysis of wireguard. Lastly, the wireguard website has lots of information for those who wish to deep dive into the inner workings of wireguard.  ","permalink":"http://rm-fr.ca/posts/wireguard_vpn/","summary":"Background Info VPN\u0026rsquo;s in my words The purpose of a VPN server at its heart is to give remote clients a private ip address on some private IP subnet that they cannot access.\nBasically the VPN server can access some subnetworks that you can\u0026rsquo;t access but want to access.\nTo do this the VPN gives you an IP address on your desired subnet which effectively makes you a client on that network with access to most or all (depending on firewall/ACL rules of the default gateway for the subnet) machines on that network.","title":"Wireguard vpn setup guide"}]